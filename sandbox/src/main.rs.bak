use murgamu::{MurMainResult, MurServer, prelude::*};

#[murgamu::main]
async fn main() -> MurMainResult {
	MurServer::new()
		.module(ModuleTest::new())
		.module(VehiclePatternModule::new())
		.bind(("127.0.0.1", 3000))?
		.run()
		.await
}

pub struct ModuleTest;
impl MurModule for ModuleTest {
	fn controllers(&self) -> Vec<Arc<dyn MurController>> {
		Vec::from([])
	}

	fn controllers_with_injects(
		&self,
		_container: &MurServiceContainer,
	) -> Vec<Arc<dyn MurController>> {
		Vec::new(ControllerTest::new())
	}

	fn services(&self) -> Vec<(TypeId, MurServiceContainer)> {
		Vec::from([(ServiceTest::as_any())])
	}

	fn name(&self) -> &str {
		"ModuleTest"
	}
	fn on_init(&self) {}
	fn on_shutdown(&self) {}
}

impl MurService for ServiceTest {
	fn as_any(&self) -> &dyn std::any::Any {
		Self {}
	}
	fn on_init(&self) {}
	fn on_shutdown(&self) {}
}

pub struct ControllerTest;
impl MurController for ControllerTest {
	fn routes(self: Arc<Self>, container: Arc<MurServiceContainer>) -> Vec<MurRouteDefinition> {
		Vec::from([MurRouteDefinition {
			method: String::from("POST"),
			path: String::from("teste"),
			handler: container,
			is_public: false,
			allowed_roles: Vec::from([String::from("")]),
		}])
	}
	fn base_path(&self) -> &str {
		"test"
	}
	fn name(&self) -> &str {
		"ControllerTest"
	}
}
